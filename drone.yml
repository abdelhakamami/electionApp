kind: pipeline
name: build 
type: kubernetes

steps:
- name: build-backend-image
  image: plugins/docker
  settings:
    registry: docker.io
    username: 
        from_secret: docker_username
    password:
        from_secret: docker_password
    dockerfile: ./back-end/Dockerfile
    repo: abdelhakavaxia/election-app-back-end
    context: ./back-end
    tags: dev
- name: build-frontend-image
  image: plugins/docker
  settings:
    reg
    istry: docker.io
    username: 
        from_secret: docker_username
    password: 
        from_secret: docker_password
    dockerfile: ./front-end/Dockerfile
    repo: abdelhakavaxia/election-app-front-end
    context: ./front-end
    tags: dev  
- name: deploy
  image: fluxcd/fluxctl:1.24.1
  enviornment:
     FLUXCD_NAMESPACE: flux-sytem
     KUSTOMIZE_BASE: election-app
  commands:
     = |
       fluxctl --k8s-fwd-ns=$FLUXCD_NAMESPACE \
        sync \
        --kustomization=$KUSTOMIZE_BASE \
        --namespace=$FLUXCD_NAMESPACE \
        --force \
        --with-source \
        --revision=main
   
