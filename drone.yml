kind: pipeline
name: build-and-push
type: kubernetes


platform:
  os: linux
  arch: amd64

steps:
  - name: build-image-back
    image: plugins/docker
    repo: abdelhakavaxia/abdelhakavaxia
    tags: dev
    dockerfile: /back-end/Dockerfile
    
    username:
      from_secret: docker_username
    password:
      from_secret: docker_password

  - name: push-image-backend
    image: plugins/docker
    settings:
      repository: abdelhakavaxia
      tag: dev
      registry: docker.io
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password

  - name: build-image-frontend
    image: docker:latest
    commands:
      - docker build -t frontend-image-:dev -f ./front-end/Dockerfile .

  - name: push-image-frontend
    image: plugins/docker
    settings:
      repository: abdelhakavaxia
      tag: dev
      registry: docker.io
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
